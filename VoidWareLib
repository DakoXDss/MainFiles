--[[
    Primordial Menu Library
    A 1:1 recreation inspired by the Primordial UI
]]

local Library = {}
Library.__index = Library

-- Services
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")

local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()

-- Theme Configuration
local Theme = {
    Background = Color3.fromRGB(25, 25, 25),
    TopBar = Color3.fromRGB(35, 35, 35),
    SideBar = Color3.fromRGB(30, 30, 30),
    Section = Color3.fromRGB(40, 40, 40),
    Accent = Color3.fromRGB(255, 75, 75),
    Text = Color3.fromRGB(255, 255, 255),
    TextDark = Color3.fromRGB(180, 180, 180),
    Border = Color3.fromRGB(20, 20, 20),
    SliderFill = Color3.fromRGB(200, 75, 75),
}

-- Utility Functions
local function CreateInstance(className, properties)
    local instance = Instance.new(className)
    for property, value in pairs(properties) do
        instance[property] = value
    end
    return instance
end

local function Tween(object, properties, duration)
    local tweenInfo = TweenInfo.new(duration or 0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
    local tween = TweenService:Create(object, tweenInfo, properties)
    tween:Play()
    return tween
end

-- Main Library Constructor
function Library:New(config)
    local self = setmetatable({}, Library)
    
    config = config or {}
    self.Title = config.Title or "Primordial"
    self.Categories = {}
    self.CurrentCategory = nil
    
    -- Create Main GUI
    self:CreateGUI()
    
    return self
end

function Library:CreateGUI()
    -- ScreenGui
    self.GUI = CreateInstance("ScreenGui", {
        Name = "PrimordialMenu",
        Parent = game:GetService("CoreGui"),
        ZIndexBehavior = Enum.ZIndexBehavior.Sibling,
        ResetOnSpawn = false
    })
    
    -- Main Frame
    self.MainFrame = CreateInstance("Frame", {
        Name = "MainFrame",
        Parent = self.GUI,
        BackgroundColor3 = Theme.Background,
        BorderSizePixel = 0,
        Position = UDim2.new(0.5, -540, 0.5, -350),
        Size = UDim2.new(0, 1080, 0, 700),
        ClipsDescendants = true
    })
    
    -- Top Bar
    local topBar = CreateInstance("Frame", {
        Name = "TopBar",
        Parent = self.MainFrame,
        BackgroundColor3 = Theme.TopBar,
        BorderSizePixel = 0,
        Size = UDim2.new(1, 0, 0, 50)
    })
    
    -- Logo/Title
    local logo = CreateInstance("ImageLabel", {
        Name = "Logo",
        Parent = topBar,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 20, 0.5, -15),
        Size = UDim2.new(0, 30, 0, 30),
        Image = "rbxasset://textures/ui/GuiImagePlaceholder.png"
    })
    
    local title = CreateInstance("TextLabel", {
        Name = "Title",
        Parent = topBar,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 60, 0, 0),
        Size = UDim2.new(0, 200, 1, 0),
        Font = Enum.Font.GothamBold,
        Text = self.Title,
        TextColor3 = Theme.Text,
        TextSize = 16,
        TextXAlignment = Enum.TextXAlignment.Left
    })
    
    -- Side Navigation
    self.SideBar = CreateInstance("Frame", {
        Name = "SideBar",
        Parent = self.MainFrame,
        BackgroundColor3 = Theme.SideBar,
        BorderSizePixel = 0,
        Position = UDim2.new(0, 0, 0, 50),
        Size = UDim2.new(0, 200, 1, -50)
    })
    
    local sideBarList = CreateInstance("UIListLayout", {
        Parent = self.SideBar,
        SortOrder = Enum.SortOrder.LayoutOrder,
        Padding = UDim.new(0, 5)
    })
    
    CreateInstance("UIPadding", {
        Parent = self.SideBar,
        PaddingTop = UDim.new(0, 10),
        PaddingLeft = UDim.new(0, 10),
        PaddingRight = UDim.new(0, 10)
    })
    
    -- Content Area
    self.ContentFrame = CreateInstance("Frame", {
        Name = "ContentFrame",
        Parent = self.MainFrame,
        BackgroundColor3 = Theme.Background,
        BorderSizePixel = 0,
        Position = UDim2.new(0, 200, 0, 50),
        Size = UDim2.new(1, -200, 1, -50),
        ClipsDescendants = true
    })
    
    -- Bottom Bar with tabs
    self.BottomBar = CreateInstance("Frame", {
        Name = "BottomBar",
        Parent = self.MainFrame,
        BackgroundColor3 = Theme.TopBar,
        BorderSizePixel = 0,
        Position = UDim2.new(0, 0, 1, -60),
        Size = UDim2.new(1, 0, 0, 60)
    })
    
    local bottomTabList = CreateInstance("UIListLayout", {
        Parent = self.BottomBar,
        FillDirection = Enum.FillDirection.Horizontal,
        HorizontalAlignment = Enum.HorizontalAlignment.Center,
        VerticalAlignment = Enum.VerticalAlignment.Center,
        Padding = UDim.new(0, 20)
    })
    
    -- Create bottom tabs
    local bottomTabs = {"Rage", "Legit", "Visuals", "Misc", "Skins", "Scripts"}
    for i, tabName in ipairs(bottomTabs) do
        local tab = CreateInstance("TextButton", {
            Name = tabName,
            Parent = self.BottomBar,
            BackgroundTransparency = 1,
            Size = UDim2.new(0, 80, 0, 40),
            Font = Enum.Font.Gotham,
            Text = tabName,
            TextColor3 = i == 2 and Theme.Accent or Theme.TextDark,
            TextSize = 13
        })
        
        if i == 2 then
            local indicator = CreateInstance("Frame", {
                Name = "Indicator",
                Parent = tab,
                BackgroundColor3 = Theme.Accent,
                BorderSizePixel = 0,
                Position = UDim2.new(0, 0, 1, -2),
                Size = UDim2.new(1, 0, 0, 2)
            })
        end
    end
    
    -- Make draggable
    self:MakeDraggable(self.MainFrame, topBar)
    
    return self.MainFrame
end

function Library:MakeDraggable(frame, handle)
    local dragging = false
    local dragInput, mousePos, framePos
    
    handle.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            mousePos = input.Position
            framePos = frame.Position
            
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then
            dragInput = input
        end
    end)
    
    RunService.Heartbeat:Connect(function()
        if dragging and dragInput then
            local delta = dragInput.Position - mousePos
            frame.Position = UDim2.new(
                framePos.X.Scale,
                framePos.X.Offset + delta.X,
                framePos.Y.Scale,
                framePos.Y.Offset + delta.Y
            )
        end
    end)
end

-- Category System
function Library:AddCategory(config)
    config = config or {}
    local categoryName = config.Name or "Category"
    local icon = config.Icon or "rbxasset://textures/ui/GuiImagePlaceholder.png"
    
    local category = {
        Name = categoryName,
        Sections = {},
        Frame = nil,
        Button = nil
    }
    
    -- Create category button in sidebar
    local button = CreateInstance("TextButton", {
        Name = categoryName,
        Parent = self.SideBar,
        BackgroundColor3 = Theme.Section,
        BorderSizePixel = 0,
        Size = UDim2.new(1, 0, 0, 40),
        Font = Enum.Font.Gotham,
        Text = "  " .. categoryName,
        TextColor3 = Theme.Text,
        TextSize = 13,
        TextXAlignment = Enum.TextXAlignment.Left
    })
    
    CreateInstance("UICorner", {
        Parent = button,
        CornerRadius = UDim.new(0, 4)
    })
    
    category.Button = button
    
    -- Create category content frame
    local contentFrame = CreateInstance("ScrollingFrame", {
        Name = categoryName .. "Content",
        Parent = self.ContentFrame,
        BackgroundTransparency = 1,
        BorderSizePixel = 0,
        Size = UDim2.new(1, 0, 1, 0),
        ScrollBarThickness = 4,
        ScrollBarImageColor3 = Theme.Accent,
        Visible = false,
        CanvasSize = UDim2.new(0, 0, 0, 0),
        AutomaticCanvasSize = Enum.AutomaticSize.Y
    })
    
    local contentList = CreateInstance("UIListLayout", {
        Parent = contentFrame,
        SortOrder = Enum.SortOrder.LayoutOrder,
        Padding = UDim.new(0, 15)
    })
    
    CreateInstance("UIPadding", {
        Parent = contentFrame,
        PaddingTop = UDim.new(0, 15),
        PaddingLeft = UDim.new(0, 15),
        PaddingRight = UDim.new(0, 15),
        PaddingBottom = UDim.new(0, 15)
    })
    
    category.Frame = contentFrame
    
    -- Button click handler
    button.MouseButton1Click:Connect(function()
        self:SelectCategory(category)
    end)
    
    table.insert(self.Categories, category)
    
    -- Select first category by default
    if #self.Categories == 1 then
        self:SelectCategory(category)
    end
    
    return setmetatable(category, {__index = self:GetCategoryMethods()})
end

function Library:SelectCategory(category)
    if self.CurrentCategory then
        self.CurrentCategory.Frame.Visible = false
        self.CurrentCategory.Button.BackgroundColor3 = Theme.Section
    end
    
    self.CurrentCategory = category
    category.Frame.Visible = true
    category.Button.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
end

-- Category Methods
function Library:GetCategoryMethods()
    local methods = {}
    
    function methods:AddSection(sectionName)
        local section = {
            Name = sectionName,
            Frame = nil,
            Elements = {}
        }
        
        -- Create section frame
        local sectionFrame = CreateInstance("Frame", {
            Name = sectionName,
            Parent = self.Frame,
            BackgroundColor3 = Theme.Section,
            BorderSizePixel = 0,
            Size = UDim2.new(1, 0, 0, 0),
            AutomaticSize = Enum.AutomaticSize.Y
        })
        
        CreateInstance("UICorner", {
            Parent = sectionFrame,
            CornerRadius = UDim.new(0, 6)
        })
        
        -- Section header
        local header = CreateInstance("Frame", {
            Name = "Header",
            Parent = sectionFrame,
            BackgroundColor3 = Theme.TopBar,
            BorderSizePixel = 0,
            Size = UDim2.new(1, 0, 0, 35)
        })
        
        CreateInstance("UICorner", {
            Parent = header,
            CornerRadius = UDim.new(0, 6)
        })
        
        local headerTitle = CreateInstance("TextLabel", {
            Name = "Title",
            Parent = header,
            BackgroundTransparency = 1,
            Position = UDim2.new(0, 15, 0, 0),
            Size = UDim2.new(1, -30, 1, 0),
            Font = Enum.Font.GothamBold,
            Text = sectionName,
            TextColor3 = Theme.Text,
            TextSize = 14,
            TextXAlignment = Enum.TextXAlignment.Left
        })
        
        -- Section content
        local content = CreateInstance("Frame", {
            Name = "Content",
            Parent = sectionFrame,
            BackgroundTransparency = 1,
            Position = UDim2.new(0, 0, 0, 35),
            Size = UDim2.new(1, 0, 0, 0),
            AutomaticSize = Enum.AutomaticSize.Y
        })
        
        local contentList = CreateInstance("UIListLayout", {
            Parent = content,
            SortOrder = Enum.SortOrder.LayoutOrder,
            Padding = UDim.new(0, 8)
        })
        
        CreateInstance("UIPadding", {
            Parent = content,
            PaddingTop = UDim.new(0, 10),
            PaddingLeft = UDim.new(0, 15),
            PaddingRight = UDim.new(0, 15),
            PaddingBottom = UDim.new(0, 10)
        })
        
        section.Frame = sectionFrame
        section.Content = content
        
        table.insert(self.Sections, section)
        
        return setmetatable(section, {__index = Library:GetSectionMethods()})
    end
    
    return methods
end

-- Section Methods
function Library:GetSectionMethods()
    local methods = {}
    
    function methods:AddToggle(config)
        config = config or {}
        local name = config.Name or "Toggle"
        local default = config.Default or false
        local callback = config.Callback or function() end
        
        local toggleFrame = CreateInstance("Frame", {
            Name = "Toggle",
            Parent = self.Content,
            BackgroundTransparency = 1,
            Size = UDim2.new(1, 0, 0, 20)
        })
        
        local toggleBox = CreateInstance("Frame", {
            Name = "Box",
            Parent = toggleFrame,
            BackgroundColor3 = Theme.Border,
            BorderSizePixel = 0,
            Size = UDim2.new(0, 18, 0, 18)
        })
        
        CreateInstance("UICorner", {
            Parent = toggleBox,
            CornerRadius = UDim.new(0, 3)
        })
        
        local checkmark = CreateInstance("Frame", {
            Name = "Checkmark",
            Parent = toggleBox,
            BackgroundColor3 = Theme.Accent,
            BorderSizePixel = 0,
            Position = UDim2.new(0.5, -6, 0.5, -6),
            Size = UDim2.new(0, 12, 0, 12),
            Visible = default
        })
        
        CreateInstance("UICorner", {
            Parent = checkmark,
            CornerRadius = UDim.new(0, 2)
        })
        
        local label = CreateInstance("TextLabel", {
            Name = "Label",
            Parent = toggleFrame,
            BackgroundTransparency = 1,
            Position = UDim2.new(0, 25, 0, 0),
            Size = UDim2.new(1, -25, 1, 0),
            Font = Enum.Font.Gotham,
            Text = name,
            TextColor3 = Theme.Text,
            TextSize = 13,
            TextXAlignment = Enum.TextXAlignment.Left
        })
        
        local toggled = default
        
        local button = CreateInstance("TextButton", {
            Name = "Button",
            Parent = toggleFrame,
            BackgroundTransparency = 1,
            Size = UDim2.new(1, 0, 1, 0),
            Text = ""
        })
        
        button.MouseButton1Click:Connect(function()
            toggled = not toggled
            checkmark.Visible = toggled
            callback(toggled)
        end)
        
        return {
            Set = function(value)
                toggled = value
                checkmark.Visible = toggled
                callback(toggled)
            end,
            Get = function()
                return toggled
            end
        }
    end
    
    function methods:AddSlider(config)
        config = config or {}
        local name = config.Name or "Slider"
        local min = config.Min or 0
        local max = config.Max or 100
        local default = config.Default or min
        local callback = config.Callback or function() end
        local suffix = config.Suffix or ""
        
        local sliderFrame = CreateInstance("Frame", {
            Name = "Slider",
            Parent = self.Content,
            BackgroundTransparency = 1,
            Size = UDim2.new(1, 0, 0, 45)
        })
        
        local label = CreateInstance("TextLabel", {
            Name = "Label",
            Parent = sliderFrame,
            BackgroundTransparency = 1,
            Size = UDim2.new(1, 0, 0, 15),
            Font = Enum.Font.Gotham,
            Text = name,
            TextColor3 = Theme.Text,
            TextSize = 13,
            TextXAlignment = Enum.TextXAlignment.Left
        })
        
        local valueLabel = CreateInstance("TextLabel", {
            Name = "Value",
            Parent = sliderFrame,
            BackgroundTransparency = 1,
            Position = UDim2.new(1, -50, 0, 0),
            Size = UDim2.new(0, 50, 0, 15),
            Font = Enum.Font.GothamBold,
            Text = tostring(default) .. suffix,
            TextColor3 = Theme.Accent,
            TextSize = 13,
            TextXAlignment = Enum.TextXAlignment.Right
        })
        
        local sliderBack = CreateInstance("Frame", {
            Name = "SliderBack",
            Parent = sliderFrame,
            BackgroundColor3 = Theme.Border,
            BorderSizePixel = 0,
            Position = UDim2.new(0, 0, 0, 25),
            Size = UDim2.new(1, 0, 0, 4)
        })
        
        CreateInstance("UICorner", {
            Parent = sliderBack,
            CornerRadius = UDim.new(0, 2)
        })
        
        local sliderFill = CreateInstance("Frame", {
            Name = "SliderFill",
            Parent = sliderBack,
            BackgroundColor3 = Theme.SliderFill,
            BorderSizePixel = 0,
            Size = UDim2.new((default - min) / (max - min), 0, 1, 0)
        })
        
        CreateInstance("UICorner", {
            Parent = sliderFill,
            CornerRadius = UDim.new(0, 2)
        })
        
        local dragging = false
        local currentValue = default
        
        local function updateSlider(input)
            local pos = math.clamp((input.Position.X - sliderBack.AbsolutePosition.X) / sliderBack.AbsoluteSize.X, 0, 1)
            currentValue = math.floor(min + (max - min) * pos)
            
            sliderFill.Size = UDim2.new(pos, 0, 1, 0)
            valueLabel.Text = tostring(currentValue) .. suffix
            
            callback(currentValue)
        end
        
        sliderBack.InputBegan:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 then
                dragging = true
                updateSlider(input)
            end
        end)
        
        sliderBack.InputEnded:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 then
                dragging = false
            end
        end)
        
        UserInputService.InputChanged:Connect(function(input)
            if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
                updateSlider(input)
            end
        end)
        
        return {
            Set = function(value)
                currentValue = math.clamp(value, min, max)
                local pos = (currentValue - min) / (max - min)
                sliderFill.Size = UDim2.new(pos, 0, 1, 0)
                valueLabel.Text = tostring(currentValue) .. suffix
                callback(currentValue)
            end,
            Get = function()
                return currentValue
            end
        }
    end
    
    function methods:AddDropdown(config)
        config = config or {}
        local name = config.Name or "Dropdown"
        local options = config.Options or {"Option 1", "Option 2"}
        local default = config.Default or options[1]
        local callback = config.Callback or function() end
        
        local dropdownFrame = CreateInstance("Frame", {
            Name = "Dropdown",
            Parent = self.Content,
            BackgroundTransparency = 1,
            Size = UDim2.new(1, 0, 0, 40),
            ClipsDescendants = false
        })
        
        local label = CreateInstance("TextLabel", {
            Name = "Label",
            Parent = dropdownFrame,
            BackgroundTransparency = 1,
            Size = UDim2.new(1, 0, 0, 15),
            Font = Enum.Font.Gotham,
            Text = name,
            TextColor3 = Theme.Text,
            TextSize = 13,
            TextXAlignment = Enum.TextXAlignment.Left
        })
        
        local dropdownBox = CreateInstance("Frame", {
            Name = "Box",
            Parent = dropdownFrame,
            BackgroundColor3 = Theme.Border,
            BorderSizePixel = 0,
            Position = UDim2.new(0, 0, 0, 20),
            Size = UDim2.new(1, 0, 0, 25)
        })
        
        CreateInstance("UICorner", {
            Parent = dropdownBox,
            CornerRadius = UDim.new(0, 4)
        })
        
        local selected = CreateInstance("TextLabel", {
            Name = "Selected",
            Parent = dropdownBox,
            BackgroundTransparency = 1,
            Position = UDim2.new(0, 10, 0, 0),
            Size = UDim2.new(1, -30, 1, 0),
            Font = Enum.Font.Gotham,
            Text = default,
            TextColor3 = Theme.Text,
            TextSize = 12,
            TextXAlignment = Enum.TextXAlignment.Left
        })
        
        local arrow = CreateInstance("TextLabel", {
            Name = "Arrow",
            Parent = dropdownBox,
            BackgroundTransparency = 1,
            Position = UDim2.new(1, -20, 0, 0),
            Size = UDim2.new(0, 20, 1, 0),
            Font = Enum.Font.GothamBold,
            Text = "▼",
            TextColor3 = Theme.TextDark,
            TextSize = 10
        })
        
        local optionsFrame = CreateInstance("Frame", {
            Name = "Options",
            Parent = dropdownFrame,
            BackgroundColor3 = Theme.Section,
            BorderSizePixel = 0,
            Position = UDim2.new(0, 0, 0, 48),
            Size = UDim2.new(1, 0, 0, 0),
            Visible = false,
            ZIndex = 10
        })
        
        CreateInstance("UICorner", {
            Parent = optionsFrame,
            CornerRadius = UDim.new(0, 4)
        })
        
        local optionsList = CreateInstance("UIListLayout", {
            Parent = optionsFrame,
            SortOrder = Enum.SortOrder.LayoutOrder,
            Padding = UDim.new(0, 2)
        })
        
        CreateInstance("UIPadding", {
            Parent = optionsFrame,
            PaddingTop = UDim.new(0, 5),
            PaddingBottom = UDim.new(0, 5)
        })
        
        local isOpen = false
        local currentValue = default
        
        for _, option in ipairs(options) do
            local optionButton = CreateInstance("TextButton", {
                Name = option,
                Parent = optionsFrame,
                BackgroundColor3 = Color3.fromRGB(50, 50, 50),
                BackgroundTransparency = 1,
                BorderSizePixel = 0,
                Size = UDim2.new(1, 0, 0, 25),
                Font = Enum.Font.Gotham,
                Text = option,
                TextColor3 = Theme.Text,
                TextSize = 12
            })
            
            optionButton.MouseEnter:Connect(function()
                optionButton.BackgroundTransparency = 0
            end)
            
            optionButton.MouseLeave:Connect(function()
                optionButton.BackgroundTransparency = 1
            end)
            
            optionButton.MouseButton1Click:Connect(function()
                currentValue = option
                selected.Text = option
                optionsFrame.Visible = false
                isOpen = false
                arrow.Text = "▼"
                callback(option)
            end)
        end
        
        optionsFrame.Size = UDim2.new(1, 0, 0, (#options * 27) + 10)
        
        local button = CreateInstance("TextButton", {
            Name = "Button",
            Parent = dropdownBox,
            BackgroundTransparency = 1,
            Size = UDim2.new(1, 0, 1, 0),
            Text = ""
        })
        
        button.MouseButton1Click:Connect(function()
            isOpen = not isOpen
            optionsFrame.Visible = isOpen
            arrow.Text = isOpen and "▲" or "▼"
            
            if isOpen then
                dropdownFrame.Size = UDim2.new(1, 0, 0, 48 + optionsFrame.AbsoluteSize.Y)
            else
                dropdownFrame.Size = UDim2.new(1, 0, 0, 40)
            end
        end)
        
        return {
            Set = function(value)
                currentValue = value
                selected.Text = value
                callback(value)
            end,
            Get = function()
                return currentValue
            end
        }
    end
    
    function methods:AddButton(config)
        config = config or {}
        local name = config.Name or "Button"
        local callback = config.Callback or function() end
        
        local buttonFrame = CreateInstance("TextButton", {
            Name = "Button",
            Parent = self.Content,
            BackgroundColor3 = Theme.Accent,
            BorderSizePixel = 0,
            Size = UDim2.new(1, 0, 0, 30),
            Font = Enum.Font.GothamBold,
            Text = name,
            TextColor3 = Theme.Text,
            TextSize = 13
        })
        
        CreateInstance("UICorner", {
            Parent = buttonFrame,
            CornerRadius = UDim.new(0, 4)
        })
        
        buttonFrame.MouseButton1Click:Connect(function()
            callback()
            
            -- Visual feedback
            Tween(buttonFrame, {BackgroundColor3 = Color3.fromRGB(200, 60, 60)}, 0.1)
            wait(0.1)
            Tween(buttonFrame, {BackgroundColor3 = Theme.Accent}, 0.1)
        end)
        
        return buttonFrame
    end
    
    return methods
end

return Library
